<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGX Minerals Transport Billing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            background-color: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .bill-container {
            display: none;
            margin-top: 30px;
            background-color: #fff;
            padding: 30px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .table {
            font-size: 14px;
        }
        .table thead th {
            background-color: #343a40;
            color: white;
        }
        .form-control:read-only {
            background-color: #f8f9fa;
        }
        #netWeight, #totalPrice {
            font-weight: bold;
        }
        .custom-dropdown {
            position: relative;
        }
        .add-new-option {
            color: #0d6efd;
            cursor: pointer;
            padding: 8px 12px;
        }
        .add-new-option:hover {
            background-color: #f8f9fa;
        }
        .dropdown-input-container {
            padding: 8px 12px;
            display: none;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .bill-container, .bill-container * {
                visibility: visible;
            }
            .bill-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 20px;
                box-shadow: none;
            }
            .no-print {
                display: none !important;
            }
            .table {
                font-size: 12px;
            }
        }
        
        /* Vehicle Lookup Styles */
        .vehicle-lookup-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .search-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        .form-group {
            flex: 1;
            min-width: 300px;
        }
        .results-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
            margin-bottom: 30px;
        }
        .results-header {
            background-color: #1e88e5;
            color: white;
            padding: 15px 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .results-content {
            padding: 25px;
        }
        .result-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .result-title {
            font-weight: 600;
            color: #1e88e5;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        .no-results {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
        }
        .add-vendor-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            display: none;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-field {
            flex: 1;
            min-width: 250px;
        }
        .vehicle-numbers-container {
            margin-top: 15px;
        }
        .vehicle-number-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .remove-vehicle {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-vehicle {
            background-color: #9e9e9e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        @media (max-width: 768px) {
            .form-group, .form-field {
                min-width: 100%;
            }
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1>SGX Minerals Transport Billing System</h1>
            <p class="lead">Complete Transport Management Solution</p>
        </div>

        <!-- Vehicle Information Lookup Section -->
        <div class="vehicle-lookup-section">
            <h3>Vehicle Information Lookup</h3>
            <div class="search-form">
                <div class="form-group">
                    <label for="vehicleSelect">Select Vehicle Number:</label>
                    <select class="form-select" id="vehicleSelect">
                        <option value="">-- Select a vehicle number --</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
            </div>
            
            <button type="button" class="btn btn-primary mt-3" onclick="searchVehicle()">Search Vehicle</button>
            <button type="button" class="btn btn-success mt-3 ms-2" onclick="toggleAddVendorForm()">Add New Vendor</button>
        </div>
        
        <section class="results-section" id="resultsSection">
            <div class="results-header">Vehicle Details</div>
            <div class="results-content" id="resultsContent">
                <!-- Results will be displayed here -->
            </div>
        </section>
        
        <section class="add-vendor-section" id="addVendorSection">
            <div class="results-header">Add New Vendor</div>
            <div class="results-content">
                <form id="vendorForm">
                    <div class="form-row">
                        <div class="form-field">
                            <label for="partyName">Party Name:</label>
                            <input type="text" class="form-control" id="partyName" required>
                        </div>
                        <div class="form-field">
                            <label for="accountNo">Account Number:</label>
                            <input type="text" class="form-control" id="accountNo" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-field">
                            <label for="bankName">Bank Name & Branch:</label>
                            <input type="text" class="form-control" id="bankName" required>
                        </div>
                        <div class="form-field">
                            <label for="beneficiary">Beneficiary:</label>
                            <input type="text" class="form-control" id="beneficiary" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-field">
                            <label for="pan">PAN Number:</label>
                            <input type="text" class="form-control" id="pan" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-field">
                            <label>Vehicle Numbers:</label>
                            <div class="vehicle-numbers-container" id="vehicleNumbersContainer">
                                <div class="vehicle-number-input">
                                    <input type="text" class="form-control vehicleNumber" placeholder="Vehicle Number" required>
                                    <button type="button" class="btn btn-danger remove-vehicle" onclick="removeVehicleField(this)">Remove</button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary add-vehicle" onclick="addVehicleField()">Add Another Vehicle</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" onclick="addNewVendor()">Save Vendor</button>
                        <button type="button" class="btn btn-secondary ms-2" onclick="toggleAddVendorForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Transport Billing Section -->
        <div class="row">
            <div class="col-md-6">
                <h3>Add New Transaction</h3>
                <form id="transactionForm">
                    <div class="mb-3 custom-dropdown">
                        <label for="client" class="form-label">Client</label>
                        <select class="form-select" id="client" required>
                            <option value="">Select Client</option>
                            <option value="L & T P1 – Rambali">L & T P1 – Rambali</option>
                            <option value="L & T P2 – Rambali">L & T P2 – Rambali</option>
                            <option value="KEC – Rambali">KEC – Rambali</option>
                            <option value="JS Mining – Rambali">JS Mining – Rambali</option>
                            <option value="ITD – Rambali">ITD – Rambali</option>
                            <option value="Sowaparnika – Rambali">Sowaparnika – Rambali</option>
                            <option value="L & T Jio – Sindhiya">L & T Jio – Sindhiya</option>
                            <option value="Arabind – Shela Nagar">Arabind – Shela Nagar</option>
                            <option value="RKD – Shela Nagar">RKD – Shela Nagar</option>
                            <option value="Afcyan – Shela Ngr">Afcyan – Shela Ngr</option>
                            <option value="Bharath Verma – Airport">Bharath Verma – Airport</option>
                            <option value="Aparna RMC – Gajuwaka">Aparna RMC – Gajuwaka</option>
                            <option value="ACC RMC – Gajuwaka">ACC RMC – Gajuwaka</option>
                            <option value="Prisam RMC – Gajuwaka">Prisam RMC – Gajuwaka</option>
                            <option value="Nuvoco RMC – Gajuwaka">Nuvoco RMC – Gajuwaka</option>
                            <option value="Ultratech – Mindi">Ultratech – Mindi</option>
                            <option value="MK Builders – Madhurwada">MK Builders – Madhurwada</option>
                            <option value="North Star Homes – Madhurwada">North Star Homes – Madhurwada</option>
                            <option value="Coastal RMC – Madhurwada">Coastal RMC – Madhurwada</option>
                            <option value="Coastal RMC – Achututapuram">Coastal RMC – Achututapuram</option>
                            <option value="Vizag Port – Vizag Port">Vizag Port – Vizag Port</option>
                        </select>
                        <div class="add-new-option" onclick="showAddOptionInput('client')">+ Add New Client</div>
                        <div class="dropdown-input-container" id="clientInputContainer">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="newClientInput" placeholder="New client name">
                                <button class="btn btn-outline-secondary" type="button" onclick="addNewOption('client')">Add</button>
                            </div>
                            <small class="text-muted">Format: Name – Location</small>
                        </div>
                    </div>
                    <div class="mb-3 custom-dropdown">
                        <label for="product" class="form-label">Product</label>
                        <select class="form-select" id="product" required>
                            <option value="">Select Product</option>
                            <option value="10mm">10mm</option>
                            <option value="20mm">20mm</option>
                            <option value="40mm">40mm</option>
                            <option value="Rivo sand">Rivo sand</option>
                            <option value="Scolpin">Scolpin</option>
                            <option value="GSB">GSB</option>
                            <option value="P/Sand">P/Sand</option>
                        </select>
                        <div class="add-new-option" onclick="showAddOptionInput('product')">+ Add New Product</div>
                        <div class="dropdown-input-container" id="productInputContainer">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="newProductInput" placeholder="New product name">
                                <button class="btn btn-outline-secondary" type="button" onclick="addNewOption('product')">Add</button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="grossWeight" class="form-label">Gross Weight (tons)</label>
                            <input type="number" step="0.01" class="form-control" id="grossWeight" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="tareWeight" class="form-label">Tare Weight (tons)</label>
                            <input type="number" step="0.01" class="form-control" id="tareWeight" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="netWeight" class="form-label">Net Weight (tons)</label>
                            <input type="number" step="0.01" class="form-control" id="netWeight" readonly>
                        </div>
                    </div>
                    <div class="mb-3 custom-dropdown">
                        <label for="transportName" class="form-label">Transport Name</label>
                        <select class="form-select" id="transportName" required>
                            <option value="">Select Transport Name</option>
                            <option value="Sri Venkateswara Transports">Sri Venkateswara Transports</option>
                            <option value="Sai Transports">Sai Transports</option>
                            <option value="Ganesh Transports">Ganesh Transports</option>
                            <option value="Lakshmi Transports">Lakshmi Transports</option>
                            <option value="Balaji Transports">Balaji Transports</option>
                            <option value="Shiva Transports">Shiva Transports</option>
                            <option value="Ram Transports">Ram Transports</option>
                            <option value="Krishna Transports">Krishna Transports</option>
                            <option value="Hanuman Transports">Hanuman Transports</option>
                            <option value="Surya Transports">Surya Transports</option>
                        </select>
                        <div class="add-new-option" onclick="showAddOptionInput('transportName')">+ Add New Transport</div>
                        <div class="dropdown-input-container" id="transportNameInputContainer">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="newTransportNameInput" placeholder="New transport name">
                                <button class="btn btn-outline-secondary" type="button" onclick="addNewOption('transportName')">Add</button>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 custom-dropdown">
                        <label for="transporterName" class="form-label">Transporter Name</label>
                        <select class="form-select" id="transporterName" required>
                            <option value="">Select Transporter Name</option>
                            <option value="Raju">Raju</option>
                            <option value="Mohan">Mohan</option>
                            <option value="Suresh">Suresh</option>
                            <option value="Ramesh">Ramesh</option>
                            <option value="Shiva">Shiva</option>
                            <option value="Venkat">Venkat</option>
                            <option value="Nagesh">Nagesh</option>
                            <option value="Chandra">Chandra</option>
                            <option value="Arun">Arun</option>
                            <option value="Prakash">Prakash</option>
                        </select>
                        <div class="add-new-option" onclick="showAddOptionInput('transporterName')">+ Add New Transporter</div>
                        <div class="dropdown-input-container" id="transporterNameInputContainer">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="newTransporterNameInput" placeholder="New transporter name">
                                <button class="btn btn-outline-secondary" type="button" onclick="addNewOption('transporterName')">Add</button>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="truckNumber" class="form-label">Truck Number</label>
                        <input type="text" class="form-control" id="truckNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="date" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price (per ton)</label>
                        <input type="number" step="0.01" class="form-control" id="price" required>
                    </div>
                    <div class="mb-3">
                        <label for="totalPrice" class="form-label">Total Price</label>
                        <input type="number" step="0.01" class="form-control" id="totalPrice" readonly>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Transaction</button>
                </form>
            </div>

            <div class="col-md-6">
                <h3>Generate Monthly Bill</h3>
                <form id="billForm">
                    <div class="mb-3">
                        <label for="billType" class="form-label">Bill Type</label>
                        <select class="form-select" id="billType" required>
                            <option value="client">Client Bill</option>
                            <option value="transporter">Transporter Bill</option>
                        </select>
                    </div>
                    <div class="mb-3" id="clientBillSection">
                        <label for="billClient" class="form-label">Select Client</label>
                        <select class="form-select" id="billClient">
                            <option value="">Select Client</option>
                            <option value="L & T P1 – Rambali">L & T P1 – Rambali</option>
                            <option value="L & T P2 – Rambali">L & T P2 – Rambali</option>
                            <option value="KEC – Rambali">KEC – Rambali</option>
                            <option value="JS Mining – Rambali">JS Mining – Rambali</option>
                            <option value="ITD – Rambali">ITD – Rambali</option>
                            <option value="Sowaparnika – Rambali">Sowaparnika – Rambali</option>
                            <option value="L & T Jio – Sindhiya">L & T Jio – Sindhiya</option>
                            <option value="Arabind – Shela Nagar">Arabind – Shela Nagar</option>
                            <option value="RKD – Shela Nagar">RKD – Shela Nagar</option>
                            <option value="Afcyan – Shela Ngr">Afcyan – Shela Ngr</option>
                            <option value="Bharath Verma – Airport">Bharath Verma – Airport</option>
                            <option value="Aparna RMC – Gajuwaka">Aparna RMC – Gajuwaka</option>
                            <option value="ACC RMC – Gajuwaka">ACC RMC – Gajuwaka</option>
                            <option value="Prisam RMC – Gajuwaka">Prisam RMC – Gajuwaka</option>
                            <option value="Nuvoco RMC – Gajuwaka">Nuvoco RMC – Gajuwaka</option>
                            <option value="Ultratech – Mindi">Ultratech – Mindi</option>
                            <option value="MK Builders – Madhurwada">MK Builders – Madhurwada</option>
                            <option value="North Star Homes – Madhurwada">North Star Homes – Madhurwada</option>
                            <option value="Coastal RMC – Madhurwada">Coastal RMC – Madhurwada</option>
                            <option value="Coastal RMC – Achututapuram">Coastal RMC – Achututapuram</option>
                            <option value="Vizag Port – Vizag Port">Vizag Port – Vizag Port</option>
                        </select>
                    </div>
                    <div class="mb-3" id="transporterBillSection" style="display: none;">
                        <label for="billTransporter" class="form-label">Select Transporter</label>
                        <select class="form-select" id="billTransporter">
                            <option value="">Select Transporter</option>
                            <option value="Raju">Raju</option>
                            <option value="Mohan">Mohan</option>
                            <option value="Suresh">Suresh</option>
                            <option value="Ramesh">Ramesh</option>
                            <option value="Shiva">Shiva</option>
                            <option value="Venkat">Venkat</option>
                            <option value="Nagesh">Nagesh</option>
                            <option value="Chandra">Chandra</option>
                            <option value="Arun">Arun</option>
                            <option value="Prakash">Prakash</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="month" class="form-label">Select Month</label>
                        <input type="month" class="form-control" id="month" required>
                    </div>
                    <button type="submit" class="btn btn-success">Generate Bill</button>
                    <button type="button" id="saveBillBtn" class="btn btn-info">Save Bill</button>
                </form>

                <div id="billContainer" class="bill-container">
                    <div class="text-center mb-4">
                        <h4>SGX Minerals Pvt Ltd</h4>
                        <p>Transport Bill</p>
                    </div>
                    <div id="billDetails" class="mb-4">
                        <div id="clientDetails"></div>
                        <div id="billPeriod"></div>
                        <div id="transportInfo"></div>
                    </div>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Product</th>
                                <th>Gross Wt.</th>
                                <th>Tare Wt.</th>
                                <th>Net Wt.</th>
                                <th>Price/Ton</th>
                                <th>Amount</th>
                                <th>Transport</th>
                                <th>Truck No.</th>
                            </tr>
                        </thead>
                        <tbody id="billTransactions">
                            <!-- Transactions will be added here -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="7" class="text-end">Total Amount:</th>
                                <th colspan="3" id="totalAmount">0.00</th>
                            </tr>
                        </tfoot>
                    </table>
                    <div class="mt-4">
                        <p>For SGX Minerals Pvt Ltd</p>
                        <p class="mt-4">_________________________</p>
                        <p>Authorized Signatory</p>
                    </div>
                    <div class="text-center mt-4 no-print">
                        <button id="printBill" class="btn btn-primary me-2">Print Bill</button>
                        <button id="downloadBill" class="btn btn-secondary">Download as PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <h3>All Transactions</h3>
                <div class="table-responsive">
                    <table class="table table-striped" id="allTransactions">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Product</th>
                                <th>Gross Wt.</th>
                                <th>Tare Wt.</th>
                                <th>Net Wt.</th>
                                <th>Transport</th>
                                <th>Transporter</th>
                                <th>Truck No.</th>
                                <th>Price/Ton</th>
                                <th>Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- All transactions will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Database setup using localStorage
        let transactions = JSON.parse(localStorage.getItem('sgx-transactions')) || [];
        let bills = JSON.parse(localStorage.getItem('sgx-bills')) || [];
        let customOptions = JSON.parse(localStorage.getItem('sgx-custom-options')) || {
            client: [],
            product: [],
            transportName: [],
            transporterName: []
        };

        // Vehicle data
        let vehicleData = [
            {
                partyName: "YARA GOVIND RAO",
                accountNo: "29611100003742",
                bankName: "DCB Bank, Anakapalli",
                beneficiary: "YARA GOVIND RAO",
                pan: "AYBPY0969R",
                vehicleNumbers: ["AP39UY3435", "AP39UY3345"]
            },
            {
                partyName: "GADASALA SHIVA",
                accountNo: "1420155000065560",
                bankName: "KVB",
                beneficiary: "Gadasala Shiva",
                pan: "BTSPG7175G",
                vehicleNumbers: ["AP39WC2389", "AP39UQ2489"]
            },
            {
                partyName: "Sri Modamamba Transport",
                accountNo: "6086101003133",
                bankName: "CANARA BANK",
                beneficiary: "Ommi Madhu babu",
                pan: "ABEYO1294K",
                vehicleNumbers: ["AP39UZ3335"]
            },
            {
                partyName: "Sri Vijayalaxmi Transport",
                accountNo: "868457131",
                bankName: "Indian Bank,Anakapalle",
                beneficiary: "S K Santosh Kumar",
                pan: "CWUPS1379C",
                vehicleNumbers: ["AP39W4518"]
            },
            {
                partyName: "Sri Polnati Venkata Srinivas Rao",
                accountNo: "11040675260",
                bankName: "SBI, Anakapalle",
                beneficiary: "Polnati Venkata Srinivasrao",
                pan: "EMOPP4189M",
                vehicleNumbers: ["AP39UH2489"]
            },
            {
                partyName: "SRI MODHAMAMBA TRANSPORT",
                accountNo: "6546322059",
                bankName: "Indian Bank Anakapalle",
                beneficiary: "MONDEPU GOPI",
                pan: "GDAPM7595D",
                vehicleNumbers: []
            },
            {
                partyName: "SRI VARDHAN TRANSPORT",
                accountNo: "6086101005682",
                bankName: "CB Anakapalle",
                beneficiary: "PRIYANKA NAGULAPALLI",
                pan: "CCOPN9093G",
                vehicleNumbers: ["AP39W3579"]
            },
            {
                partyName: "SHREE NOOKAMBICA LORRY TRANSPORT",
                accountNo: "30893220505",
                bankName: "SBI, Anakapalle",
                beneficiary: "P.N.K.A Ananda Rao",
                pan: "CHOPP3166M",
                vehicleNumbers: ["AP39UF3245"]
            },
            {
                partyName: "LAKSHMI SRINIVASA TRANSPORT",
                accountNo: "053501505619",
                bankName: "ICICI, Anakapalle",
                beneficiary: "Gali Venkata Nukaraju",
                pan: "BQDPG9659K",
                vehicleNumbers: ["AP39W0505", "AP39WC7499"]
            },
            {
                partyName: "SRI MODAMAMBA LORRY TRANSPORT -POLNATI RAMU",
                accountNo: "039301000039226",
                bankName: "Indian Overseas Bank-Anakapalli",
                beneficiary: "POLNATI RAMU",
                pan: "AMEPP6405E",
                vehicleNumbers: ["AP39TV2536"]
            },
            {
                partyName: "POLNATI LAKSHMANA",
                accountNo: "20393866584",
                bankName: "SBI, Anakapalle",
                beneficiary: "POLNATI LAKSHMANA",
                pan: "EHGPP6721J",
                vehicleNumbers: ["AP39TV2537"]
            },
            {
                partyName: "GADASALA VENKATA RAO",
                accountNo: "41897007408",
                bankName: "SBI, Anakapalle",
                beneficiary: "GADASALA VENKATA RAO",
                pan: "BNLPG8819G",
                vehicleNumbers: []
            },
            {
                partyName: "Sri Durga Devi Lorry Services",
                accountNo: "30758927213",
                bankName: "SBI, Anakapalle",
                beneficiary: "N.Narisinga Rao",
                pan: "APCPN4125N",
                vehicleNumbers: []
            },
            {
                partyName: "Sri Balaji Transport",
                accountNo: "20286779205",
                bankName: "SBI",
                beneficiary: "Gangiredla Srinivasa Rao",
                pan: "BZJPG9951K",
                vehicleNumbers: ["AP39UE5163", "AP39VB2727", "AP39UP4799"]
            },
            {
                partyName: "BINDHU SREE TRANSPORT AND CONSTRUCTIONS",
                accountNo: "053505500548",
                bankName: "ICICI, Anakapalle",
                beneficiary: "NAMMI SUNITHA",
                pan: "BMHPB1489C",
                vehicleNumbers: []
            },
            {
                partyName: "Sri Venkata Durga Lorry service",
                accountNo: "50100398807876",
                bankName: "HDFC, Anakapalle",
                beneficiary: "Ullingala Nageswar Rao",
                pan: "CKQPN5200B",
                vehicleNumbers: ["AP39TN2579", "AP39UJ2669"]
            },
            {
                partyName: "Mummina Srinu",
                accountNo: "31897791454",
                bankName: "SBI",
                beneficiary: "Mummina Srinu",
                pan: "NIEPS1843A",
                vehicleNumbers: []
            },
            {
                partyName: "LANKA NAGESWARA RAO",
                accountNo: "386602010025075",
                bankName: "UNION BANK",
                beneficiary: "Lanka Nageswara Rao",
                pan: "AYWPL8780A",
                vehicleNumbers: ["AP39UU5665"]
            },
            {
                partyName: "R.K TRANSPORT",
                accountNo: "18862612000462",
                bankName: "PUNJAB NATIONAL BANK",
                beneficiary: "Ommi Venkata Rao",
                pan: "CACPV1217L",
                vehicleNumbers: ["AP39UG0559"]
            },
            {
                partyName: "SRI SIVA DURGA LORRY SERVICE",
                accountNo: "44005352428",
                bankName: "SBI, ANAKAPALLI",
                beneficiary: "Kommuri Durga Prasad",
                pan: "CKBPK7332L",
                vehicleNumbers: ["AP39WD8349"]
            },
            {
                partyName: "SRI MANIKANTA BALaji LORRY TRANSPORT",
                accountNo: "33982901231",
                bankName: "SBI, Anakapalle",
                beneficiary: "M SOMUNAIDU",
                pan: "CLXPM8882N",
                vehicleNumbers: ["AP39WD4199"]
            },
            {
                partyName: "Sri Kanaka Durga LorrySERVICE",
                accountNo: "50100482507472",
                bankName: "HDFC, Anakapalle",
                beneficiary: "CH.POLANDRA",
                pan: "FRQPP2042K",
                vehicleNumbers: ["AP39UJ2399"]
            },
            {
                partyName: "K DURGA RAO",
                accountNo: "184010100508162",
                bankName: "AXIS BANK OF INDIA ANAKAPALLE",
                beneficiary: "K.DURGA RAO",
                pan: "BCBPR6347H",
                vehicleNumbers: ["AP31TN4302"]
            },
            {
                partyName: "SRI BALA DURGA LORRY SERVICE",
                accountNo: "36055252391",
                bankName: "SBI, Anakapalle",
                beneficiary: "J.SRI PADHAVALLAABHA",
                pan: "CCEPJ2049G",
                vehicleNumbers: ["AP39VF2339"]
            },
            {
                partyName: "SRI MODA VENKATA SURYA LORRY SERVICE",
                accountNo: "33808097568",
                bankName: "ANAKAPALLE",
                beneficiary: "POLNATI TATA RAO",
                pan: "BYEPP6263R",
                vehicleNumbers: ["AP39UC6939"]
            },
            {
                partyName: "Hanuman Lorry Service",
                accountNo: "42325671649",
                bankName: "Anakapalli",
                beneficiary: "T.Venkata Suresh",
                pan: "QSPPS5777F",
                vehicleNumbers: []
            },
            {
                partyName: "POLNATI ANNAPURNA",
                accountNo: "6086101003959",
                bankName: "CANARA BANK",
                beneficiary: "Polnati Annapuran",
                pan: "DWOPP2749J",
                vehicleNumbers: ["AP39WC9149", "AP39UP9239"]
            },
            {
                partyName: "SRI VIJAYA DURGA ENTERPRISES",
                accountNo: "31499967751",
                bankName: "SBI ANAKAPALLE",
                beneficiary: "VASADI RAMESH",
                pan: "AGNPV7563J",
                vehicleNumbers: []
            },
            {
                partyName: "VYSHNAVI LORRY TRANSPORT",
                accountNo: "053501507032",
                bankName: "ICICI, Anakapalle",
                beneficiary: "KARANAM A SRINIVASARAO",
                pan: "PJFPS1223C",
                vehicleNumbers: []
            }
        ];

        // Price per ton based on location
        const locationPrices = {
            'Rambali': 260,
            'Gajuwaka': 170,
            'Madhurwada': 260,
            'Sindhiya': 190,
            'Shela Nagar': 210,
            'Shela Ngr': 230,
            'Airport': 210,
            'Mindi': 180,
            'Achututapuram': 170,
            'Vizag Port': 260
        };

        // DOM elements
        const transactionForm = document.getElementById('transactionForm');
        const billForm = document.getElementById('billForm');
        const allTransactionsTable = document.getElementById('allTransactions').getElementsByTagName('tbody')[0];
        const billContainer = document.getElementById('billContainer');
        const billTransactions = document.getElementById('billTransactions');
        const totalAmountElement = document.getElementById('totalAmount');
        const printBillBtn = document.getElementById('printBill');
        const downloadBillBtn = document.getElementById('downloadBill');
        const saveBillBtn = document.getElementById('saveBillBtn');
        const clientDetails = document.getElementById('clientDetails');
        const billPeriod = document.getElementById('billPeriod');
        const transportInfo = document.getElementById('transportInfo');
        const grossWeightInput = document.getElementById('grossWeight');
        const tareWeightInput = document.getElementById('tareWeight');
        const netWeightInput = document.getElementById('netWeight');
        const priceInput = document.getElementById('price');
        const totalPriceInput = document.getElementById('totalPrice');
        const clientSelect = document.getElementById('client');
        const billTypeSelect = document.getElementById('billType');
        const clientBillSection = document.getElementById('clientBillSection');
        const transporterBillSection = document.getElementById('transporterBillSection');

        // Toggle between client and transporter bill sections
        billTypeSelect.addEventListener('change', function() {
            if (this.value === 'client') {
                clientBillSection.style.display = 'block';
                transporterBillSection.style.display = 'none';
                document.getElementById('billTransporter').required = false;
                document.getElementById('billClient').required = true;
            } else {
                clientBillSection.style.display = 'none';
                transporterBillSection.style.display = 'block';
                document.getElementById('billClient').required = false;
                document.getElementById('billTransporter').required = true;
            }
        });

        // Calculate net weight and total price automatically
        grossWeightInput.addEventListener('input', calculateWeights);
        tareWeightInput.addEventListener('input', calculateWeights);
        priceInput.addEventListener('input', calculateTotalPrice);

        // Set price based on selected client location
        clientSelect.addEventListener('change', function() {
            const selectedClient = this.value;
            if (selectedClient) {
                const location = selectedClient.split('–')[1].trim();
                if (locationPrices[location]) {
                    priceInput.value = locationPrices[location];
                    calculateTotalPrice();
                }
            }
        });

        function calculateWeights() {
            const grossWeight = parseFloat(grossWeightInput.value) || 0;
            const tareWeight = parseFloat(tareWeightInput.value) || 0;
            
            // Validate that gross weight is greater than tare weight
            if (tareWeight > 0 && grossWeight <= tareWeight) {
                alert('Gross weight must be greater than tare weight');
                tareWeightInput.value = '';
                netWeightInput.value = '';
                totalPriceInput.value = '';
                return;
            }
            
            const netWeight = grossWeight - tareWeight;
            netWeightInput.value = netWeight.toFixed(2);
            calculateTotalPrice();
        }

        function calculateTotalPrice() {
            const netWeight = parseFloat(netWeightInput.value) || 0;
            const price = parseFloat(priceInput.value) || 0;
            const totalPrice = netWeight * price;
            totalPriceInput.value = totalPrice.toFixed(2);
        }

        // Show input field to add new option
        function showAddOptionInput(fieldType) {
            // Hide all input containers first
            document.querySelectorAll('.dropdown-input-container').forEach(container => {
                container.style.display = 'none';
            });
            
            // Show the selected input container
            document.getElementById(`${fieldType}InputContainer`).style.display = 'block';
        }

        // Add new option to dropdown
        function addNewOption(fieldType) {
            const inputField = document.getElementById(`new${fieldType.charAt(0).toUpperCase() + fieldType.slice(1)}Input`);
            const newValue = inputField.value.trim();
            
            if (!newValue) {
                alert('Please enter a value');
                return;
            }
            
            // Add to custom options
            if (!customOptions[fieldType].includes(newValue)) {
                customOptions[fieldType].push(newValue);
                localStorage.setItem('sgx-custom-options', JSON.stringify(customOptions));
            }
            
            // Add to dropdown
            const selectElement = document.getElementById(fieldType);
            const option = document.createElement('option');
            option.value = newValue;
            option.textContent = newValue;
            selectElement.appendChild(option);
            
            // Select the new option
            selectElement.value = newValue;
            
            // Hide input container and clear input
            document.getElementById(`${fieldType}InputContainer`).style.display = 'none';
            inputField.value = '';
            
            // If it's a client field, try to set price based on location
            if (fieldType === 'client') {
                const location = newValue.split('–')[1];
                if (location && locationPrices[location.trim()]) {
                    priceInput.value = locationPrices[location.trim()];
                    calculateTotalPrice();
                }
            }
        }

        // Load custom options into dropdowns
        function loadCustomOptions() {
            for (const fieldType in customOptions) {
                const selectElement = document.getElementById(fieldType);
                customOptions[fieldType].forEach(value => {
                    if (!selectElement.querySelector(`option[value="${value}"]`)) {
                        const option = document.createElement('option');
                        option.value = value;
                        option.textContent = value;
                        selectElement.appendChild(option);
                    }
                });
            }
        }

        // Form submit - Add new transaction
        transactionForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate weights again
            const grossWeight = parseFloat(grossWeightInput.value);
            const tareWeight = parseFloat(tareWeightInput.value);
            
            if (grossWeight <= tareWeight) {
                alert('Gross weight must be greater than tare weight');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                client: document.getElementById('client').value,
                product: document.getElementById('product').value,
                grossWeight: grossWeight,
                tareWeight: tareWeight,
                netWeight: parseFloat(netWeightInput.value),
                transportName: document.getElementById('transportName').value,
                transporterName: document.getElementById('transporterName').value,
                truckNumber: document.getElementById('truckNumber').value,
                date: document.getElementById('date').value,
                price: parseFloat(priceInput.value),
                totalPrice: parseFloat(totalPriceInput.value)
            };
            
            transactions.push(transaction);
            saveTransactions();
            renderAllTransactions();
            transactionForm.reset();
            
            // Reset price if it was auto-set
            if (clientSelect.value) {
                const location = clientSelect.value.split('–')[1].trim();
                if (locationPrices[location]) {
                    priceInput.value = locationPrices[location];
                }
            }
            
            alert('Transaction saved successfully!');
        });

        // Form submit - Generate bill
        billForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const billType = document.getElementById('billType').value;
            const month = document.getElementById('month').value;
            
            if (billType === 'client') {
                const client = document.getElementById('billClient').value;
                if (!client) {
                    alert('Please select a client');
                    return;
                }
                generateBill('client', client, month);
            } else {
                const transporter = document.getElementById('billTransporter').value;
                if (!transporter) {
                    alert('Please select a transporter');
                    return;
                }
                generateBill('transporter', transporter, month);
            }
        });

        // Save bill button
        saveBillBtn.addEventListener('click', function() {
            if (!billContainer.style.display || billContainer.style.display === 'none') {
                alert('Please generate a bill first');
                return;
            }
            
            const billType = document.getElementById('billType').value;
            const month = document.getElementById('month').value;
            const billFor = billType === 'client' 
                ? document.getElementById('billClient').value 
                : document.getElementById('billTransporter').value;
            
            // Get the transactions shown in the bill
            const billTransactionsData = [];
            const rows = billTransactions.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                billTransactionsData.push({
                    date: cells[0].textContent,
                    client: cells[1].textContent,
                    product: cells[2].textContent,
                    grossWeight: parseFloat(cells[3].textContent),
                    tareWeight: parseFloat(cells[4].textContent),
                    netWeight: parseFloat(cells[5].textContent),
                    price: parseFloat(cells[6].textContent.replace('₹', '')),
                    amount: parseFloat(cells[7].textContent.replace('₹', '')),
                    transportName: cells[8].textContent,
                    truckNumber: cells[9].textContent
                });
            }
            
            const bill = {
                id: Date.now(),
                billType,
                billFor,
                month,
                transactions: billTransactionsData,
                totalAmount: parseFloat(totalAmountElement.textContent),
                createdAt: new Date().toISOString()
            };
            
            bills.push(bill);
            localStorage.setItem('sgx-bills', JSON.stringify(bills));
            alert('Bill saved successfully!');
        });

        // Print bill button
        printBillBtn.addEventListener('click', function() {
            window.print();
        });

        // Download as PDF button
        downloadBillBtn.addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            // Add company header
            doc.setFontSize(16);
            doc.setTextColor(40);
            doc.text('SGX Minerals Pvt Ltd', doc.internal.pageSize.width / 2, 15, { align: 'center' });
            doc.setFontSize(14);
            doc.text('Transport Bill', doc.internal.pageSize.width / 2, 22, { align: 'center' });
            
            // Add bill details
            doc.setFontSize(12);
            const clientDetailsText = clientDetails.innerHTML.split('<br>');
            clientDetailsText.forEach((line, index) => {
                if (line.trim() !== '') {
                    doc.text(line.replace(/<[^>]*>/g, ''), 20, 40 + (index * 7));
                }
            });
            
            // Add bill period
            const billPeriodText = billPeriod.innerHTML.split('<br>');
            billPeriodText.forEach((line, index) => {
                if (line.trim() !== '') {
                    doc.text(line.replace(/<[^>]*>/g, ''), 20, 60 + (index * 7));
                }
            });
            
            // Add transport info if filtered
            const transportInfoText = transportInfo.innerHTML.split('<br>');
            if (transportInfoText[0].trim() !== '') {
                transportInfoText.forEach((line, index) => {
                    if (line.trim() !== '') {
                        doc.text(line.replace(/<[^>]*>/g, ''), 20, 80 + (index * 7));
                    }
                });
            }
            
            // Add table headers
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            const headers = ["Date", "Client", "Product", "Gross", "Tare", "Net", "Price", "Amount", "Transport", "Truck No"];
            let x = 15;
            const columnWidths = [20, 30, 20, 15, 15, 15, 15, 20, 25, 25];
            headers.forEach((header, index) => {
                doc.text(header, x, 100);
                x += columnWidths[index];
            });
            
            // Add transactions
            doc.setFont(undefined, 'normal');
            const rows = billTransactions.getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                x = 15;
                for (let j = 0; j < cells.length; j++) {
                    doc.text(cells[j].textContent, x, 110 + (i * 10));
                    x += columnWidths[j];
                }
            }
            
            // Add total
            doc.setFont(undefined, 'bold');
            doc.text(`Total Amount: ₹${totalAmountElement.textContent}`, doc.internal.pageSize.width - 20, 110 + (rows.length * 10), { align: 'right' });
            
            // Add footer
            doc.setFontSize(10);
            doc.text('For SGX Minerals Pvt Ltd', 20, 130 + (rows.length * 10));
            doc.text('Authorized Signatory', doc.internal.pageSize.width - 20, 150 + (rows.length * 10), { align: 'right' });
            doc.line(doc.internal.pageSize.width - 50, 152 + (rows.length * 10), doc.internal.pageSize.width - 20, 152 + (rows.length * 10));
            
            // Save the PDF
            const billType = document.getElementById('billType').value;
            const billFor = billType === 'client' 
                ? document.getElementById('billClient').value 
                : document.getElementById('billTransporter').value;
            const month = document.getElementById('month').value;
            
            let filename = '';
            if (billType === 'client') {
                filename = `SGX_Client_Bill_${billFor.split('–')[0].trim()}_${month}`;
            } else {
                filename = `SGX_Transporter_Bill_${billFor}_${month}`;
            }
            
            doc.save(`${filename}.pdf`);
        });

        // Save transactions to localStorage
        function saveTransactions() {
            localStorage.setItem('sgx-transactions', JSON.stringify(transactions));
        }

        // Render all transactions in the table
        function renderAllTransactions() {
            allTransactionsTable.innerHTML = '';
            
            transactions.forEach(transaction => {
                const row = allTransactionsTable.insertRow();
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.client}</td>
                    <td>${transaction.product}</td>
                    <td>${transaction.grossWeight.toFixed(2)}</td>
                    <td>${transaction.tareWeight.toFixed(2)}</td>
                    <td>${transaction.netWeight.toFixed(2)}</td>
                    <td>${transaction.transportName}</td>
                    <td>${transaction.transporterName}</td>
                    <td>${transaction.truckNumber}</td>
                    <td>₹${transaction.price.toFixed(2)}</td>
                    <td>₹${transaction.totalPrice.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteTransaction(${transaction.id})">Delete</button>
                    </td>
                `;
            });
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN');
        }

        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(transaction => transaction.id !== id);
                saveTransactions();
                renderAllTransactions();
                
                // Hide bill container if it's showing the deleted transaction
                billContainer.style.display = 'none';
            }
        }

        // Generate bill for a client or transporter for a specific month
        function generateBill(billType, billFor, month) {
            const [year, monthNum] = month.split('-');
            let filteredTransactions = transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                return (billType === 'client' ? transaction.client === billFor : transaction.transporterName === billFor) &&
                       transactionDate.getFullYear() == year && 
                       (transactionDate.getMonth() + 1) == monthNum;
            });
            
            if (filteredTransactions.length === 0) {
                alert(`No transactions found for ${billType === 'client' ? 'this client' : 'this transporter'} in the selected month.`);
                return;
            }
            
            // Display bill container
            billContainer.style.display = 'block';
            
            // Set bill details
            const monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"];
            
            if (billType === 'client') {
                clientDetails.innerHTML = `
                    <strong>Client:</strong> ${billFor.split('–')[0].trim()}<br>
                    <strong>Location:</strong> ${billFor.split('–')[1].trim()}
                `;
            } else {
                clientDetails.innerHTML = `
                    <strong>Transporter:</strong> ${billFor}
                `;
            }
            
            billPeriod.innerHTML = `
                <strong>Bill Period:</strong> ${monthNames[parseInt(monthNum) - 1]} ${year}<br>
                <strong>Bill Date:</strong> ${new Date().toLocaleDateString()}
            `;
            
            // Add transactions to bill
            billTransactions.innerHTML = '';
            let totalAmount = 0;
            
            filteredTransactions.forEach(transaction => {
                const row = billTransactions.insertRow();
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.client}</td>
                    <td>${transaction.product}</td>
                    <td>${transaction.grossWeight.toFixed(2)}</td>
                    <td>${transaction.tareWeight.toFixed(2)}</td>
                    <td>${transaction.netWeight.toFixed(2)}</td>
                    <td>₹${transaction.price.toFixed(2)}</td>
                    <td>₹${transaction.totalPrice.toFixed(2)}</td>
                    <td>${transaction.transportName}</td>
                    <td>${transaction.truckNumber}</td>
                `;
                
                totalAmount += transaction.totalPrice;
            });
            
            // Update total amount
            totalAmountElement.textContent = totalAmount.toFixed(2);
        }

        // Vehicle Lookup Functions
        // Populate the dropdown with vehicle numbers
        function populateVehicleDropdown() {
            const vehicleSelect = document.getElementById('vehicleSelect');
            // Clear existing options except the first one
            while (vehicleSelect.options.length > 1) {
                vehicleSelect.remove(1);
            }
            
            const allVehicleNumbers = [];
            
            vehicleData.forEach(vehicle => {
                vehicle.vehicleNumbers.forEach(number => {
                    if (number && !allVehicleNumbers.includes(number)) {
                        allVehicleNumbers.push(number);
                        const option = document.createElement('option');
                        option.value = number;
                        option.textContent = number;
                        vehicleSelect.appendChild(option);
                    }
                });
            });
        }

        // Search function
        function searchVehicle() {
            const selectValue = document.getElementById('vehicleSelect').value;
            
            if (!selectValue) {
                alert('Please select a vehicle number');
                return;
            }
            
            const results = vehicleData.filter(vehicle => 
                vehicle.vehicleNumbers.includes(selectValue)
            );
            
            displayResults(results, selectValue);
        }

        // Display results
        function displayResults(results, searchValue) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsContent.innerHTML = '';
            
            if (results.length === 0) {
                resultsContent.innerHTML = '<div class="no-results">No details found for vehicle number: ' + searchValue + '</div>';
            } else {
                results.forEach(vehicle => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    
                    resultDiv.innerHTML = `
                        <div class="result-title">Party Name: ${vehicle.partyName}</div>
                        <div><strong>Bank Account No.:</strong> ${vehicle.accountNo}</div>
                        <div><strong>Bank Name & Branch:</strong> ${vehicle.bankName}</div>
                        <div><strong>Beneficiary:</strong> ${vehicle.beneficiary}</div>
                        <div><strong>PAN:</strong> ${vehicle.pan}</div>
                        <div><strong>Vehicle Numbers:</strong> ${vehicle.vehicleNumbers.join(', ')}</div>
                    `;
                    
                    resultsContent.appendChild(resultDiv);
                });
            }
            
            resultsSection.style.display = 'block';
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Toggle add vendor form
        function toggleAddVendorForm() {
            const addVendorSection = document.getElementById('addVendorSection');
            const resultsSection = document.getElementById('resultsSection');
            
            if (addVendorSection.style.display === 'block') {
                addVendorSection.style.display = 'none';
                document.getElementById('vendorForm').reset();
                // Reset to single vehicle field
                const container = document.getElementById('vehicleNumbersContainer');
                while (container.children.length > 1) {
                    container.removeChild(container.lastChild);
                }
            } else {
                addVendorSection.style.display = 'block';
                resultsSection.style.display = 'none';
                addVendorSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Add vehicle field
        function addVehicleField() {
            const container = document.getElementById('vehicleNumbersContainer');
            const newField = document.createElement('div');
            newField.className = 'vehicle-number-input';
            newField.innerHTML = `
                <input type="text" class="form-control vehicleNumber" placeholder="Vehicle Number">
                <button type="button" class="btn btn-danger remove-vehicle" onclick="removeVehicleField(this)">Remove</button>
            `;
            container.appendChild(newField);
        }

        // Remove vehicle field
        function removeVehicleField(button) {
            const container = document.getElementById('vehicleNumbersContainer');
            if (container.children.length > 1) {
                container.removeChild(button.parentNode);
            }
        }

        // Add new vendor
        function addNewVendor() {
            const partyName = document.getElementById('partyName').value.trim();
            const accountNo = document.getElementById('accountNo').value.trim();
            const bankName = document.getElementById('bankName').value.trim();
            const beneficiary = document.getElementById('beneficiary').value.trim();
            const pan = document.getElementById('pan').value.trim();
            
            // Get all vehicle numbers
            const vehicleInputs = document.querySelectorAll('.vehicleNumber');
            const vehicleNumbers = [];
            
            vehicleInputs.forEach(input => {
                const value = input.value.trim().toUpperCase();
                if (value) {
                    vehicleNumbers.push(value);
                }
            });
            
            // Validate required fields
            if (!partyName || !accountNo || !bankName || !beneficiary || !pan || vehicleNumbers.length === 0) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Create new vendor object
            const newVendor = {
                partyName,
                accountNo,
                bankName,
                beneficiary,
                pan,
                vehicleNumbers
            };
            
            // Add to data array
            vehicleData.push(newVendor);
            
            // Update dropdown
            populateVehicleDropdown();
            
            // Show success message
            alert('Vendor added successfully!');
            
            // Reset form and hide it
            document.getElementById('vendorForm').reset();
            toggleAddVendorForm();
        }

        // Initialize the app
        function init() {
            loadCustomOptions();
            renderAllTransactions();
            populateVehicleDropdown();
            
            // Set default date to today
            document.getElementById('date').valueAsDate = new Date();
        }

        // Make functions available globally
        window.deleteTransaction = deleteTransaction;
        window.showAddOptionInput = showAddOptionInput;
        window.addNewOption = addNewOption;
        window.searchVehicle = searchVehicle;
        window.toggleAddVendorForm = toggleAddVendorForm;
        window.addVehicleField = addVehicleField;
        window.removeVehicleField = removeVehicleField;
        window.addNewVendor = addNewVendor;

        init();
    </script>
</body>
</html>
